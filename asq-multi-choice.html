<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-radio-group/paper-radio-group.html">
<link rel="import" href="../asq-option/asq-option.html">
<link rel="import" href="../asq-element-common/asq-element-common.html">

<polymer-element name="asq-multi-choice" attributes="choose">
  <template>
    <style>
    </style>

    <!-- (for now) Keep same when either viewer or presenter -->
    <div class="asq-multi-choice">
      <content select="asq-stem"></content>
      <div id="choices">
        <ol>
        <!-- if choose == 1 we need a paper-radio-group element to group 
        paper-radio-buttons  -->
        <template if="{{choose=='1'}}">
          <paper-radio-group>
            <content></content>
          </paper-radio-group>
        </template>
        <template if="{{choose!='1'}}">
            <content></content>
        </template>
        </ol>
      </div>
    </div>
    
  </template>

  <script>
  (function() {
    var p = {
      choose: "n",

      ready: function(){
        //make asq-option elements checkboxes or radio buttons
        var inputType = (this.choose == '1')
          ? 'radio'
          : 'checkbox';
        console.log(this.choose, inputType)
        var aos = this.querySelectorAll('asq-option');
        aos = Array.prototype.slice.call(aos);
        aos.forEach(function(ao){
          ao.type = inputType;
        })
      },

      submit: function() {
        if ( this.role !== this.Roles.VIEWER ) {
          return;
        }
        console.log(this.childNodes);
        var options = this.childNodes.array().filter(function(el) {
          return el.isASQElement && el.nodeName == "ASQ-OPTION";
        });

        console.log("options", options);
        var submisstion = [];
        options.forEach(function(elem, index) {
          submisstion.push(elem.submit());
        });   

        return {
          questionId: "",
          timestamp: new Date(),
          submisstion: submisstion
        };
      }

    }

    ASQ.mixin2(p, ASQ.RoleMixin);
    Polymer.mixin(p, ASQ.ElementTypeMixin, ASQ.QuestionTypeMixin);
    Polymer('asq-multi-choice', p);

  })();
  </script>
</polymer-element>